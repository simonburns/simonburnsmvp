!function(window,undef){var angular=window.angular;if(angular!==undef){var module=angular.module("wrapParse",[]);module.factory("wrapParse",function(){var conversion,wrapParse;return conversion={Number:function(value){return Number(value)},Boolean:function(value){return"boolean"==typeof value?value:Boolean(Number(value))},Date:function(value){if(value instanceof Date){var newDate=new Date(value.valueOf()+6e4*value.getTimezoneOffset());return newDate.setSeconds(0),newDate.setMinutes(0),newDate.setHours(0),newDate}return moment(value,wrapParse.dateFormat).toDate()},Relation:function(value,fieldType){return value instanceof fieldType?value:new fieldType({id:value})}},wrapParse=function(modelName,cols){if("function"==typeof modelName&&modelName._name&&"Relation"===modelName._name)return modelName;var obj;obj=modelName===Parse.User?modelName:Parse.Object.extend(modelName),_.forOwn(cols,function(fieldType,fieldName){var defaultValue;"object"==typeof fieldType&&(defaultValue=fieldType.default,fieldType=fieldType.type),Object.defineProperty(obj.prototype,fieldName,{enumerable:!0,configurable:!1,get:function(){var value=this.get(fieldName);return value=void 0===value?defaultValue:value,void 0!==value&&"Boolean"===fieldType.name?conversion.Boolean(value):value},set:function(value){this.set(fieldName,value)}})}),obj=_.extend(obj,{_name:"Relation",query:function(){return new Parse.Query(obj)},find:function(onSuccess,onError){return obj.query().find(onSuccess,onError),this},get:function(id,onSuccess,onError){return obj.query().get(id,onSuccess,onError),this}});var originalSave=Parse.Object.prototype.save;return Parse.Object.prototype=_.extend(Parse.Object.prototype,{save:function(data){return"object"==typeof data&&this.set(data),this.beforeSave(),this.parseFields(),originalSave.apply(this,arguments)},parseFields:function(){var self=this;return _.forOwn(cols,function(fieldType,fieldName){var type=fieldType.name||fieldType._name;void 0!==self[fieldName]&&"function"==typeof conversion[type]&&(self[fieldName]=conversion[type](self[fieldName],fieldType))}),self},beforeSave:function(){}}),obj},wrapParse.dateFormat="YYYY-MM-DD",wrapParse}),module.run(["$q","$window",function($q,$window){if(!angular.isUndefined($window.Parse)&&angular.isObject($window.Parse)){var Parse=$window.Parse,methodsToUpdate={Object:{prototype:["save","fetch","destroy"],"static":["saveAll","destroyAll"]},Collection:{prototype:["fetch"],"static":[]},Query:{prototype:["find","first","count","get"],"static":[]},Cloud:{prototype:[],"static":["run"]},User:{prototype:["signUp"],"static":["requestPasswordReset","logIn"]},FacebookUtils:{prototype:[],"static":["logIn","link","unlink"]}};for(var k in methodsToUpdate){var currentClass=k,currentObject=methodsToUpdate[k],currentProtoMethods=currentObject.prototype,currentStaticMethods=currentObject.static;currentProtoMethods.forEach(function(method){var origMethod=Parse[currentClass].prototype[method];Parse[currentClass].prototype[method]=function(){return origMethod.apply(this,arguments).then(function(data){var defer=$q.defer();return defer.resolve(data),defer.promise},function(err){var defer=$q.defer();return defer.reject(err),defer.promise})}}),currentStaticMethods.forEach(function(method){var origMethod=Parse[currentClass][method];Parse[currentClass][method]=function(){return origMethod.apply(this,arguments).then(function(data){var defer=$q.defer();return defer.resolve(data),defer.promise},function(err){var defer=$q.defer();return defer.reject(err),defer.promise})}})}}}])}}(this);